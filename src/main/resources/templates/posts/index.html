<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/header :: head('Posts')"></head>
<body>
<nav th:replace="fragments/navbar.html :: user-navbar"></nav>

<header class="container my-5"></header>
<div class="jumbotron-show">
    <h1 class="text-center text-dark display-1" id="h1-show">Posts</h1>
</div>

<div class="container">
    <form action="#" th:action="@{/posts}" method="get" class="input-group">
        <input class="form-control rounded" type="text" id="search"
               placeholder="Search: posts, title..."
               name="search" aria-label="Search"/>
        <div class="input-group-append">
            <label for="query-input"></label>
            <button type="submit" class="btn" id="query-input" value="search">Search</button>
            <!--                            <input class="button fas fa-search fa-lg" type="submit" id="ingredient-query-input"/>-->
        </div>
    </form>

    <div class="card-columns mt-4">

        <div th:each="post : ${posts}">
            <div sec:authorize="isAuthenticated()">

                <div class="card card-hover shadow bg-white rounded">
                    <img class="card-img-top" th:attr="src=@{${post.postImageUrl}}" alt="Recipe image">
                    <div class="card-body">
                        <a th:href="@{|/post/${post.id}|}">
                            <h2 class="card-title text-center" th:text="${post.title}"></h2>
                        </a>

                    </div>
                    <div class="card-footer">
                        <div th:if="${user.id} == ${post.getUser().id}">
                            <a th:href="@{|/posts/${post.id}/edit|}">
                                <button>Edit</button>
                            </a>
                            <form th:action="@{|/posts/${post.id}/delete|}" th:method="POST">
                                <button type="submit">Delete</button>
                            </form>
                        </div>
                        <div th:if="${user.id} != ${post.getUser().id}">
                            <h4 th:text="${post.user.username}"></h4>
                        </div>
                    </div>
                </div>
            </div>
            <!-- explains if user is a visitor then access is the public posts only -->
            <div sec:authorize="isAnonymous()">
                <div th:if="${post.getAccess() == 'public'}">
                    <div class="card card-hover shadow bg-white rounded">
                        <img class="card-img-top" th:attr="src=@{${post.postImageUrl}}" alt="Recipe image">
                        <div class="card-body">
                            <a th:href="@{|/post/${post.id}|}">
                                <h2 class="card-title text-center" th:text="${post.title}"></h2>
                            </a>

                        </div>
                        <div class="card-footer">
                            <h4 th:text="${post.user.username}"></h4>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="fragments/scripts.html :: scripts"></div>
<footer th:replace="fragments/footer.html :: footer"></footer>
</body>
</html>