<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/header :: head('Post View')"></head>

<body class="background-maroon">
<nav th:replace="fragments/navbar.html :: user-navbar"></nav>
<div class="container p-0">
    <div class="jumbotron jumbotron-fluid m-0" style="height: 35vh!important;">

        <img th:src="|${post.postImageUrl}|" alt="jumbotron post image" class="img-fluid" style="
          position: absolute;
          z-index: 1;
          top: 0;
          width:100%;
          height:100%;
          object-fit: cover;
          /*opacity:0.5*/
          ;"/>

        <div class="container text-white text-center">
            <h2 th:text="${post.title}" class="display-1"></h2>
        </div>
    </div>
</div>

<div class="container bg-white p-0">
    <div class="p-2">
        <div sec:authorize="isAuthenticated()">
            <div th:if="${user.id} != ${post.user.id}">
                <a th:href="@{|/contact-us/${post.id}|}">
                    <button>Report an Issue</button>
                </a>
            </div>
        </div>
    <!--    <img th:attr="src=@{${post.postImageUrl}}" style="width: 15em; height: 10em;"/>-->
        <h2 th:text="'User: ' + ${post.user.username}"></h2>

        <div>
            <h5>Categories</h5>
        </div>
        <div th:each="category : ${post.categories}">
            <p th:text="${category.name}"></p>
        </div>

        <div sec:authorize="isAuthenticated()">
            <!--        <div th:if="${user.id} != ${post.getUser().id}">-->
            <!--            <a href="/contact-us">-->
            <!--                <button>Report Issue</button>-->
            <!--            </a>-->
            <!--        </div>-->
            <div th:if="${user.id} == ${post.getUser().id} OR ${user.userRole} == 'admin'">
                <a th:href="@{|/posts/${post.id}/edit|}">
                    <button>Edit</button>
                </a>
                <form th:action="@{|/posts/${post.id}/delete|}" th:method="POST">
                    <button type="submit">Delete</button>
                </form>
            </div>

            <div th:if="|${!user.containsPost(post)}|">
                <form th:action="@{|/favorite/${post.id}|}" th:method="POST">
                    <button type="submit">Add to Favorites</button>
                </form>
            </div>
            <div th:if="|${user.containsPost(post)}|">
                <form th:action="@{|/favorites/${post.id}/delete|}"
                      th:method="POST">
                    <button type="submit">Remove Favorite</button>
                </form>
            </div>
            <a th:href="@{|/comments/post/${post.id}|}">
                <button>Comment</button>
            </a>
            <!--        <form th:action="@{|/comments/post/${post.id}|}"-->
            <!--              th:method="POST">-->
            <!--            <button type="submit">Comment</button>-->
            <!--        </form>-->
        </div>
        <h4 th:text="${post.body}"></h4>
        <div th:each="comment : ${post.comments}">

    <!--*********** THIS IS WHERE THE ERROR IS STARTING **************-->
            <div sec:authorize="isAuthenticated()">
                <div th:if="${user.id} == ${comment.user.id}">
                    <form th:action="@{|/comments/post/${comment.id}/delete|}" th:method="POST"
                          style="display:inline">
                        <!--                                                    <button class="mb-3">Delete Comment</button>-->
                        <button class="button">Delete</button>
                    </form>
                    <!-- <a th:href="@{|/comment/${comment.id}/edit|}">
                        <button class="button fas fa-edit fa-lg"></button> -->
                        <!--                                                    <button>Edit Comment</button>-->
                    <!-- </a> -->
                </div>
            </div>
        </div>
        
            <!--<form th:action="@{|/recipe/${recipe.id}/delete|}" th:method="POST"
      style="display:inline" class="d-inline mt-2 p-0 m-0">
    <button class="button fas fa-trash fa-2x"></button>
</form>-->

            <p th:text="${comment.comment_txt}"
               style="width: 40%;height: 100px;padding: 10px; background-color: lightgray;"></p>
            <p th:text="${comment.prettyDate()}" style="font-size: x-small; text-shadow: lightgray"></p>
        </div>
    </div>
</div>


<div class="fixed-bottom">
    <div th:replace="fragments/scripts.html :: scripts"></div>
<!--    <footer th:replace="fragments/footer.html :: footer"></footer>-->
</div>
</body>
</html>



